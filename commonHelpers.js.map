{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\nconst refs = {\n  searchFormElement: document.querySelector('.search-form'),\n  searchInput: document.querySelector('.search-input'),\n  searchBtn: document.querySelector('.search-btn'),\n  imagesMarkUp: document.querySelector('.images-markup'),\n  loadBtn: document.querySelector('.load-btn'),\n};\n\nconst API_KEY = '41860696-2902f93b7313ed5ba840414ce';\n\nconst PER_PAGE = 40;\n\nlet gallery = new SimpleLightbox('.small-image-item a');\n\nlet query = '';\n\nlet numOfPage;\n\nconst instance = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\nrefs.searchFormElement.addEventListener('submit', searchQuery);\nrefs.loadBtn.addEventListener('click', onLoadMore);\n\nfunction searchQuery(e) {\n  e.preventDefault();\n  numOfPage = 1;\n  refs.imagesMarkUp.innerHTML = ``;\n  query = refs.searchInput.value.toLowerCase();\n  refs.imagesMarkUp.insertAdjacentHTML(\n    'beforeend',\n    `<li class=\"loader-item\"><span class=\"loader\"></span></li>`\n  );\n  fetchImages();\n}\n\nfunction onBadQuery() {\n  refs.imagesMarkUp.innerHTML = ``;\n\n  iziToast.error({\n    theme: 'dark',\n    position: 'topRight',\n    maxWidth: '392px',\n    messageSize: '16px',\n    messageLineHeight: '24px',\n    backgroundColor: '#EF4040',\n    messageColor: '#FAFAFB',\n    message:\n      'Sorry, there are no images matching your search query. Please, try again!',\n    progressBarColor: '#B51B1B',\n  });\n}\n\nfunction onRequestError(error) {\n  refs.imagesMarkUp.innerHTML = ``;\n  refs.loadBtn.classList.add('hidden');\n  iziToast.error({\n    theme: 'dark',\n    position: 'topRight',\n    maxWidth: '392px',\n    messageSize: '16px',\n    messageLineHeight: '24px',\n    backgroundColor: '#EF4040',\n    messageColor: '#FAFAFB',\n    message: `Something went wrong:: ${error}`,\n    progressBarColor: '#B51B1B',\n  });\n}\n\nfunction checkLimit(limit) {\n  if (refs.imagesMarkUp.childNodes.length >= limit) {\n    refs.loadBtn.classList.add('hidden');\n    refs.imagesMarkUp.insertAdjacentHTML(\n      'beforeend',\n      `<p class=\"limit-message\">We're sorry, but you've reached the end of search results.</p>`\n    );\n    return;\n  }\n}\n\nfunction renderMarkUp(data) {\n  document.querySelector('.loader-item').remove();\n  const markUp = data.hits.reduce(\n    (html, image) =>\n      html +\n      `<li class=\"small-image-item\"><a href=\"${image.largeImageURL}\"><img src=\"${image.webformatURL}\" class=\"small-image\" alt=\"${image.tags}\" /></a><ul class=\"description-image-list\"><li class=\"description-image-item\"><p class=\"description-title\">Likes</p><p class=\"description-value\">${image.likes}</p></li>\n          <li class=\"description-image-item\"><p class=\"description-title\">Views</p><p class=\"description-value\">${image.views}</p></li>\n          <li class=\"description-image-item\"><p class=\"description-title\">Comments</p><p class=\"description-value\">${image.comments}</p></li>\n          <li class=\"description-image-item\"><p class=\"description-title\">Downloads</p><p class=\"description-value\">${image.downloads}</p></li></ul></li>`,\n    ''\n  );\n  refs.imagesMarkUp.insertAdjacentHTML('beforeend', markUp);\n\n  checkLimit(data.totalHits);\n\n  gallery.refresh();\n}\n\nasync function onLoadMore() {\n  numOfPage += 1;\n  refs.imagesMarkUp.insertAdjacentHTML(\n    'beforeend',\n    `<li class=\"loader-item\"><span class=\"loader\"></span></li>`\n  );\n\n  await fetchImages();\n\n  window.scrollBy({\n    top:\n      document.querySelector('.small-image-item').getBoundingClientRect()\n        .height * 2,\n    left: 0,\n    behavior: 'smooth',\n  });\n}\n\nasync function fetchImages() {\n  refs.loadBtn.classList.add('hidden');\n  try {\n    const response = await instance.get(\n      `?key=${API_KEY}&q=${query}&image-type=photo&orientation=horizontal&safesearch=true&page=${numOfPage}&per_page=${PER_PAGE}`\n    );\n    const responseData = await response.data;\n\n    if (responseData.hits.length <= 0) {\n      onBadQuery();\n      return;\n    }\n    refs.loadBtn.classList.remove('hidden');\n    renderMarkUp(responseData);\n  } catch (e) {\n    onRequestError(e.message);\n  }\n}\n"],"names":["refs","API_KEY","PER_PAGE","gallery","SimpleLightbox","query","numOfPage","instance","axios","searchQuery","onLoadMore","e","fetchImages","onBadQuery","iziToast","onRequestError","error","checkLimit","limit","renderMarkUp","data","markUp","html","image","responseData"],"mappings":"owBAMA,MAAMA,EAAO,CACX,kBAAmB,SAAS,cAAc,cAAc,EACxD,YAAa,SAAS,cAAc,eAAe,EACnD,UAAW,SAAS,cAAc,aAAa,EAC/C,aAAc,SAAS,cAAc,gBAAgB,EACrD,QAAS,SAAS,cAAc,WAAW,CAC7C,EAEMC,EAAU,qCAEVC,EAAW,GAEjB,IAAIC,EAAU,IAAIC,EAAe,qBAAqB,EAElDC,EAAQ,GAERC,EAEJ,MAAMC,EAAWC,EAAM,OAAO,CAC5B,QAAS,2BACT,QAAS,CACP,eAAgB,kBACjB,CACH,CAAC,EAEDR,EAAK,kBAAkB,iBAAiB,SAAUS,CAAW,EAC7DT,EAAK,QAAQ,iBAAiB,QAASU,CAAU,EAEjD,SAASD,EAAYE,EAAG,CACtBA,EAAE,eAAc,EAChBL,EAAY,EACZN,EAAK,aAAa,UAAY,GAC9BK,EAAQL,EAAK,YAAY,MAAM,YAAW,EAC1CA,EAAK,aAAa,mBAChB,YACA,2DACJ,EACEY,GACF,CAEA,SAASC,GAAa,CACpBb,EAAK,aAAa,UAAY,GAE9Bc,EAAS,MAAM,CACb,MAAO,OACP,SAAU,WACV,SAAU,QACV,YAAa,OACb,kBAAmB,OACnB,gBAAiB,UACjB,aAAc,UACd,QACE,4EACF,iBAAkB,SACtB,CAAG,CACH,CAEA,SAASC,EAAeC,EAAO,CAC7BhB,EAAK,aAAa,UAAY,GAC9BA,EAAK,QAAQ,UAAU,IAAI,QAAQ,EACnCc,EAAS,MAAM,CACb,MAAO,OACP,SAAU,WACV,SAAU,QACV,YAAa,OACb,kBAAmB,OACnB,gBAAiB,UACjB,aAAc,UACd,QAAS,0BAA0BE,IACnC,iBAAkB,SACtB,CAAG,CACH,CAEA,SAASC,EAAWC,EAAO,CACzB,GAAIlB,EAAK,aAAa,WAAW,QAAUkB,EAAO,CAChDlB,EAAK,QAAQ,UAAU,IAAI,QAAQ,EACnCA,EAAK,aAAa,mBAChB,YACA,yFACN,EACI,MACD,CACH,CAEA,SAASmB,EAAaC,EAAM,CAC1B,SAAS,cAAc,cAAc,EAAE,OAAM,EAC7C,MAAMC,EAASD,EAAK,KAAK,OACvB,CAACE,EAAMC,IACLD,EACA,yCAAyCC,EAAM,4BAA4BA,EAAM,0CAA0CA,EAAM,wJAAwJA,EAAM;AAAA,kHACnLA,EAAM;AAAA,qHACHA,EAAM;AAAA,sHACLA,EAAM,+BACxH,EACJ,EACEvB,EAAK,aAAa,mBAAmB,YAAaqB,CAAM,EAExDJ,EAAWG,EAAK,SAAS,EAEzBjB,EAAQ,QAAO,CACjB,CAEA,eAAeO,GAAa,CAC1BJ,GAAa,EACbN,EAAK,aAAa,mBAChB,YACA,2DACJ,EAEE,MAAMY,EAAW,EAEjB,OAAO,SAAS,CACd,IACE,SAAS,cAAc,mBAAmB,EAAE,sBAAuB,EAChE,OAAS,EACd,KAAM,EACN,SAAU,QACd,CAAG,CACH,CAEA,eAAeA,GAAc,CAC3BZ,EAAK,QAAQ,UAAU,IAAI,QAAQ,EACnC,GAAI,CAIF,MAAMwB,EAAe,MAHJ,MAAMjB,EAAS,IAC9B,QAAQN,OAAaI,kEAAsEC,cAAsBJ,GACvH,GACwC,KAEpC,GAAIsB,EAAa,KAAK,QAAU,EAAG,CACjCX,IACA,MACD,CACDb,EAAK,QAAQ,UAAU,OAAO,QAAQ,EACtCmB,EAAaK,CAAY,CAC1B,OAAQb,EAAP,CACAI,EAAeJ,EAAE,OAAO,CACzB,CACH"}